$(document).ready(function(){var e=$('<img src="'+$.glue.base_url+'modules/webvideo/webvideo.png" alt="btn" title="embed a youtube or vimeo video" width="32" height="32">'),e=($(e).bind("click",function(l){var e,a,o,i,t=prompt("Enter the video URL (e.g. http://www.youtube.com/watch?v=_mdVHEus0T8)");t&&(o=!1,-1!=t.indexOf("youtube")?-1==(a=t.indexOf("v="))?$.glue.error("Error understanding the youtube link"):(-1==(e=t.indexOf("&",a+=2))&&(e=t.length),o="youtube",i=t.slice(a,e)):-1!=t.indexOf("vimeo")?-1==(a=t.indexOf(".com/"))?$.glue.error("Error understanding the vimeo link"):(a+=5,o="vimeo",i=String(parseInt(t.slice(a)))):$.glue.error("Only youtube and vimeo videos are supported at the moment."),o&&$.glue.backend({method:"glue.create_object",page:$.glue.page},function(e){var a,t,d=$('<div class="webvideo resizable object" style="position: absolute;"></div>');$(d).attr("id",e.name),"youtube"==o?(a="//",t=$('<iframe class="youtube-player" src="'+a+"www.youtube.com/embed/"+i+'?rel=0" style="border-width: 0px; height: 100%; position: absolute; width: 100%;"></iframe>')):"vimeo"==o&&(a="//",t=$('<iframe src="'+a+"player.vimeo.com/video/"+i+'?title=0&amp;byline=0&amp;portrait=0&amp;color=ffffff" style="border-width: 0px; height: 100%; position: absolute; width: 100%;"></iframe>')),$(d).append(t),t=$('<div class="glue-webvideo-handle glue-ui" title="drag here"></div>'),$(d).append(t),$("body").append(d),$(d).css("width",$(d).width()+"px"),$(d).css("height",$(d).height()+"px"),$(d).css("left",l.pageX-$(d).outerWidth()/2+"px"),$(d).css("top",l.pageY-$(d).outerHeight()/2+"px"),$.glue.object.register(d),$.glue.backend({method:"glue.update_object",name:$(d).attr("id"),"webvideo-provider":o,"webvideo-id":i}),$.glue.object.save(d)}),$.glue.menu.hide())}),$.glue.menu.register("new",e,13),$('<div style="height: 32px; width: 32px;" title="toggle automatic playback of video (takes effect after a reload)">'));$(e).bind("glue-menu-activate",function(e){var a,t=$(this).data("owner");void 0===$(t).data("webvideo-autoplay")?($(this).removeClass("glue-menu-enabled"),$(this).removeClass("glue-menu-disabled"),a=this,$.glue.backend({method:"glue.load_object",name:$(t).attr("id")},function(e){"autoplay"==e["webvideo-autoplay"]?($(a).addClass("glue-menu-enabled"),$(t).data("webvideo-autoplay","autoplay")):($(a).addClass("glue-menu-disabled"),$(t).data("webvideo-autoplay",""))})):"autoplay"==$(t).data("webvideo-autoplay")?($(this).addClass("glue-menu-enabled"),$(this).removeClass("glue-menu-disabled")):($(this).removeClass("glue-menu-enabled"),$(this).addClass("glue-menu-disabled"))}),$(e).bind("click",function(e){var a=$(this).data("owner");$(this).hasClass("glue-menu-enabled")?($(this).removeClass("glue-menu-enabled"),$(this).addClass("glue-menu-disabled"),$(a).data("webvideo-autoplay",""),$.glue.backend({method:"glue.object_remove_attr",name:$(a).attr("id"),attr:"webvideo-autoplay"})):$(this).hasClass("glue-menu-disabled")&&($(this).addClass("glue-menu-enabled"),$(this).removeClass("glue-menu-disabled"),$(a).data("webvideo-autoplay",""),$.glue.backend({method:"glue.update_object",name:$(a).attr("id"),"webvideo-autoplay":"autoplay"}))}),$.glue.contextmenu.register("webvideo","webvideo-autoplay",e),e=$('<div style="height: 32px; width: 32px;" title="toggle looping of video (takes effect after a reload)">'),$(e).bind("glue-menu-activate",function(e){var a,t=$(this).data("owner");void 0===$(t).data("webvideo-loop")?($(this).removeClass("glue-menu-enabled"),$(this).removeClass("glue-menu-disabled"),a=this,$.glue.backend({method:"glue.load_object",name:$(t).attr("id")},function(e){"loop"==e["webvideo-loop"]?($(a).addClass("glue-menu-enabled"),$(t).data("webvideo-loop","loop")):($(a).addClass("glue-menu-disabled"),$(t).data("webvideo-loop",""))})):"loop"==$(t).data("webvideo-loop")?($(this).addClass("glue-menu-enabled"),$(this).removeClass("glue-menu-disabled")):($(this).removeClass("glue-menu-enabled"),$(this).addClass("glue-menu-disabled"))}),$(e).bind("click",function(e){var a=$(this).data("owner");$(this).hasClass("glue-menu-enabled")?($(this).removeClass("glue-menu-enabled"),$(this).addClass("glue-menu-disabled"),$(a).data("webvideo-loop",""),$.glue.backend({method:"glue.object_remove_attr",name:$(a).attr("id"),attr:"webvideo-loop"})):$(this).hasClass("glue-menu-disabled")&&($(this).addClass("glue-menu-enabled"),$(this).removeClass("glue-menu-disabled"),$(a).data("webvideo-loop","loop"),$.glue.backend({method:"glue.update_object",name:$(a).attr("id"),"webvideo-loop":"loop"}))}),$.glue.contextmenu.register("webvideo","webvideo-loop",e),$.glue.object.register_alter_pre_save("iframe",function(e,a){$(e).children("iframe").html(""),$(e).children(".glue-webvideo-handle").remove()})});