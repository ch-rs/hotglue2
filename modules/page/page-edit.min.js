$(document).ready(function(){for(i in $.glue.grid.x($.glue.conf.page.default_grid_x),$.glue.grid.y($.glue.conf.page.default_grid_y),$.glue.conf.page.guides_x)$.glue.grid.add_guide_x($.glue.conf.page.guides_x[i]);for(i in $.glue.conf.page.guides_y)$.glue.grid.add_guide_y($.glue.conf.page.guides_y[i]);var e=$('<img src="'+$.glue.base_url+'modules/page/page-title.png" alt="btn" title="change page title" width="32" height="32">'),g=($(e).bind("click",function(e){var g=$("title").html();null!==(g=prompt("Change the page title",g))&&($("title").html(g),$.glue.backend({method:"glue.update_object",name:$.glue.page+".page","page-title":g}))}),$.glue.menu.register("page",e),e=$('<img src="'+$.glue.base_url+'modules/page/page-url.png" alt="btn" title="change the page&#039;s url" width="32" height="32">'),$(e).bind("click",function(e){var t=$.glue.page.split(".").shift(),a=prompt("Change the page URL",t);null!=a&&a!=t&&$.glue.backend({method:"glue.get_startpage"},function(e){var g=!1;e==$.glue.page&&(g=!0),$.glue.backend({method:"glue.rename_page",old:t,new:a},function(e){g?$.glue.backend({method:"glue.set_startpage",page:a+".head"},function(e){window.location=$.glue.base_url+"?"+a+"/edit"}):window.location=$.glue.base_url+"?"+a+"/edit"})}),$.glue.menu.hide()}),$.glue.menu.register("page",e),e=$('<img src="'+$.glue.base_url+'modules/page/page-set-startpage.png" alt="btn" title="make this the start page" width="32" height="32">'),$(e).bind("click",function(e){$.glue.backend({method:"glue.set_startpage",page:$.glue.page}),$.glue.menu.hide()}),$.glue.menu.register("page",e),e=$('<img src="'+$.glue.base_url+'img/background-color.png" alt="btn" title="change the background color" width="32" height="32">'),$(e).bind("click",function(e){if(0!=$("html").css("background-image").length&&"none"!=$("html").css("background-image")){if(!confirm("Do you want to clear the current background image?"))return void $.glue.menu.hide();$.glue.backend({method:"page.clear_background_img",page:$.glue.page}),$("html").css("background-image","")}var g=$("html").css("background-color");e.shiftKey&&!(g=prompt("Enter background color (e.g. #ff0000 or rgb(255, 0, 0))",g))||($.glue.colorpicker.show(g,!1,function(e){$("html").css("background-color",e)},function(e){$.glue.grid.update(!0),$.glue.backend({method:"glue.update_object",name:$.glue.page+".page","page-background-color":e})}),$.glue.menu.hide())}),$.glue.menu.register("page",e),e=$('<img src="'+$.glue.base_url+'modules/page/page-new.png" alt="btn" title="create a new page" width="32" height="32">'),$(e).bind("click",function(e){$.glue.menu.hide();var g=prompt("Name the page to be created");null!==g&&$.glue.backend({method:"glue.create_page",page:g+".head"},function(e){window.location=$.glue.base_url+"?"+g+"/edit"})}),$.glue.menu.register("page",e),e=$('<img src="'+$.glue.base_url+'modules/page/page-delete.png" alt="btn" title="delete page" width="32" height="32">'),$(e).bind("click",function(e){var a,l;confirm("Really delete the current page and all it's revisions?")&&(a=$.glue.page.split(".").shift(),l=[],$.glue.backend({method:"glue.revisions",pagename:a},function(e){for(var g in e)l.push(a+"."+e[g]);for(var t in l)$.glue.backend({method:"glue.delete_page",page:l[t]});window.location=$.glue.base_url+"?pages"})),$.glue.menu.hide()}),$.glue.menu.register("page",e),e=$('<div style="height: 32px; max-height: 32px; max-width: 32px; overflow: hidden; width: 32px;"><img src="'+$.glue.base_url+'modules/page/page-background-image.png" alt="btn" width="32" height="32"></div>'),{error:function(e){e&&e.target&&e.target.status?$.glue.error("There was a problem uploading a file (status "+e.target.status+")"):($.glue.error("There was a problem uploading a file. Make sure you are not exceeding the file size limits set in the server configuration."),console.error(e)),$.glue.menu.hide()},finish:function(e){e?e["#error"]?$.glue.error("There was a problem uploading the file ("+e["#data"]+")"):$("html").css("background-image","url("+$.glue.base_url+"?"+$.glue.page+".page&"+(new Date).getTime()+")"):$.glue.error("There was a problem communicating with the server"),$.glue.menu.hide()},tooltip:"upload a background image"});$.glue.upload.button(e,{method:"glue.upload_files",page:$.glue.page,preferred_module:"page"},g),$.glue.menu.register("page",e),e=$('<div id="glue-menu-page-background-scroll" alt="btn" style="height: 32px; width: 32px;" title="toggle between having the background image fixed or having it scroll with the rest of the page">'),$(e).bind("glue-menu-activate",function(e){var g=$("#glue-menu-page-background-scroll");0!=$("html").css("background-image").length&&"none"!=$("html").css("background-image")?("fixed"==$("html").css("background-attachment")?($(g).removeClass("glue-menu-enabled"),$(g).addClass("glue-menu-disabled")):($(g).addClass("glue-menu-enabled"),$(g).removeClass("glue-menu-disabled")),$(g).css("display","block")):$(g).css("display","none")}),$(e).bind("click",function(e){"fixed"==$("html").css("background-attachment")?($("html").css("background-attachment","scroll"),$.glue.backend({method:"glue.update_object",name:$.glue.page+".page","page-background-attachment":"scroll"}),$(this).addClass("glue-menu-enabled"),$(this).removeClass("glue-menu-disabled")):($("html").css("background-attachment","fixed"),$.glue.backend({method:"glue.update_object",name:$.glue.page+".page","page-background-attachment":"fixed"}),$(this).removeClass("glue-menu-enabled"),$(this).addClass("glue-menu-disabled"))}),$.glue.menu.register("page",e),e=$('<img src="'+$.glue.base_url+'modules/page/page-background-image-pos.png" alt="btn" title="adjust background image selection" width="32" height="32">'),$(e).bind("glue-menu-activate",function(e){var g=$("#glue-menu-page-background-scroll");0!=$("html").css("background-image").length&&"none"!=$("html").css("background-image")?$(g).css("display","block"):$(g).css("display","none")}),$(e).bind("mousedown",function(e){var t,a,g=$("html").css("background-position").split(" "),l=(2!=g.length?a=t=0:(t=parseInt(g[0]),isNaN(t)&&(t=0),a=parseInt(g[1]),isNaN(a)&&(a=0)),!0);return $.glue.slider(e,function(e,g){$("html").css("background-position",t+e+"px "+(a+g)+"px"),0==e&&0==g||(l=!1)},function(e,g){l?($("html").css("background-position",""),$.glue.backend({method:"glue.object_remove_attr",name:$.glue.page+".page",attr:"page-background-image-position"})):$.glue.backend({method:"glue.update_object",name:$.glue.page+".page","page-background-image-position":$("html").css("background-position")})}),!1}),$.glue.menu.register("page",e),e=$('<img src="'+$.glue.base_url+'modules/page/page-grid.png" width="32" height="32">'),$(e).attr("title","show/hide grid or change grid size by dragging ("+$.glue.grid.x()+"x"+$.glue.grid.y()+")"),$(e).bind("mousedown",function(e){var t=this;return $.glue.slider(e,function(e,g,t){t.shiftKey&&(e<g?e=g:g=e);t=!1;10<=Math.abs(e)&&($.glue.grid.mode(1),$.glue.grid.x(Math.abs(e)),t=!0),10<=Math.abs(g)&&($.glue.grid.mode(1),$.glue.grid.y(Math.abs(g)),t=!0),t&&$.glue.grid.update(!0)},function(e,g){Math.abs(e)<10&&Math.abs(g)<10&&($.glue.grid.mode()?$.glue.grid.mode(0):$.glue.grid.mode(1),$.glue.grid.update()),$.glue.backend({method:"page.set_grid",x:$.glue.grid.x(),y:$.glue.grid.y()}),$(t).attr("title","show/hide grid or change grid size by dragging ("+$.glue.grid.x()+"x"+$.glue.grid.y()+")"),$.glue.menu.hide()}),!1}),$.glue.menu.register("page",e,13),e=$('<img src="'+$.glue.base_url+'modules/page/responsive-temp-icon.png" width="32" height="32">'),$(e).attr("title","change responsive mode"),$(e).bind("mousedown",function(e){var g=["default","fluid-container","fluid-left-container","fluid-tiles"],t=g.indexOf($("html").attr("data-responsive-mode")),t=((t=t<0?0:t)+1)%g.length;alert("Responsive mode is now "+g[t]),$("html").attr("data-responsive-mode",g[t]),$.glue.backend({method:"page.set_responsive_mode",mode:g[t],page:$.glue.page}),$(this).attr("title","change responsive mode (currently "+g[t]+")"),$.glue.menu.hide()}),$.glue.menu.register("page",e,14),e=$('<img src="'+$.glue.base_url+'modules/page/page-container-size.png" width="32" height="32">'),$(e).attr("title","change responsive mode ("+(parseInt(document.documentElement.style.getPropertyValue("--container-width"))||"unset")+")"),$(e).bind("mousedown",function(e){var t=this;let a=parseInt(document.documentElement.style.getPropertyValue("--container-width"));$.glue.slider(e,function(e,g,t){e=Math.max(200,a+e);document.documentElement.style.setProperty("--container-width",e)},function(e,g){$.glue.backend({method:"page.set_container_width",width:a+parseInt(e),page:$.glue.page}),$(t).attr("title","change responsive mode (currently "+(a+parseInt(e))+")"),$.glue.menu.hide()})}),$.glue.menu.register("page",e,15)});