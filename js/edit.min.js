$.glue.canvas={update:function(e){void 0===e&&(e=$(".object"));var t=0,i=0;$(e).each(function(){var e=$(this).position();t<e.left+$(this).outerWidth()&&(t=e.left+$(this).outerWidth()),i<e.top+$(this).outerHeight()&&(i=e.top+$(this).outerHeight())}),t<$(window).width()&&(t=$(window).width()),i<$(window).height()&&(i=$(window).height()),$.glue.grid.update()}},$.glue.colorpicker=function(){function s(e){$(e.target).hasClass("glue-ui")||0!=$(e.target).parents(".glue-ui").length||($.glue.colorpicker.hide(),e.stopImmediatePropagation())}var l=!1,n=!1,r=!1,a=!1,c=$('<div id="glue-colorpicker" class="glue-ui" style="z-index: 202;"><div id="glue-colorpicker-transparent" class="glue-ui"></div><div id="glue-colorpicker-wheel" style="height: 195px; width: 195px;" title="set transparent"></div></div>');$(c).children("#glue-colorpicker-wheel").farbtastic(function(e){e!==n&&($(c).children("#glue-colorpicker-wheel").find(".marker").attr("title",e),$(c).children("#glue-colorpicker-transparent").removeClass("glue-colorpicker-transparent-set"),$(c).children("#glue-colorpicker-transparent").addClass("glue-colorpicker-transparent-notset"),"function"==typeof l&&l(e),n=e)}),$(c).children("#glue-colorpicker-transparent").bind("click",function(e){$(this).addClass("glue-colorpicker-transparent-set"),$(this).removeClass("glue-colorpicker-transparent-notset"),"function"==typeof l&&l("transparent"),n="transparent"});return{hide:function(e){a&&(void 0!==e&&0!=e||"function"==typeof r&&r(n),$(c).detach(),a=!1),$("body").unbind("click",s)},is_shown:function(){return a},set_color:function(e){$.color.setColor(e);var t=$.color.getRGB(),i=$.color.getHex();"block"==$(c).children("#glue-colorpicker-transparent").css("display")?0==t.a?($(c).children("#glue-colorpicker-transparent").addClass("glue-colorpicker-transparent-set"),$(c).children("#glue-colorpicker-transparent").removeClass("glue-colorpicker-transparent-notset"),e="transparent"):($(c).children("#glue-colorpicker-transparent").removeClass("glue-colorpicker-transparent-set"),$(c).children("#glue-colorpicker-transparent").addClass("glue-colorpicker-transparent-notset")):0==t.r&&0==t.g&&0==t.b&&0==t.a&&(i="#ffffff"),$.farbtastic($(c).children("#glue-colorpicker-wheel")).setColor(i),$(c).children("#glue-colorpicker-wheel").find(".marker").attr("title",i),n=e},show:function(e,t,i,o){a&&$.glue.colorpicker.hide(),n=!1,l=i,r=o,t?$(c).children("#glue-colorpicker-transparent").css("display","block"):$(c).children("#glue-colorpicker-transparent").css("display","none"),"string"!=typeof e||0==e.length?($.farbtastic($(c).children("#glue-colorpicker-wheel")).setColor("#ff0000"),$(c).children("#glue-colorpicker-wheel").find(".marker").removeAttr("title")):$.glue.colorpicker.set_color(e),$("body").append(c),a=!0,$("body").bind("click",s)}}}(),$.glue.contextmenu=function(){var g=[],h={},p=!1,f=!1,m=[],v={};return $(".object").live("glue-deselect",function(e){$.glue.contextmenu.hide()}),$(".object").live("glue-movestart",function(e){this==p&&(f=p,$.glue.contextmenu.hide())}),$(".object").live("glue-movestop",function(e){this==f&&($.glue.contextmenu.show(f),f=!1)}),$(".object").live("glue-select",function(e){1==$(".glue-selected").length?$.glue.contextmenu.show(this):$.glue.contextmenu.hide()}),{hide:function(){if(p){for(;g.length;){var e=g.shift();$(e.elem).trigger("glue-menu-deactivate"),$(e.elem).detach()}for(;m.length;){e=m.shift();$(e.elem).trigger("glue-menu-deactivate"),$(e.elem).detach()}p=!1}},is_shown:function(){return!!p},register:function(e,t,i,o){h[e]||(h[e]=[]),h[e].push({name:t,elem:i,prio:o=void 0===o?10:o})},reuse:function(e,t,i,o){for(var s in void 0===o&&(o=10),h)for(var l,n=0;n<h[s].length;n++)if(h[s][n].name==t)return l=$(h[s][n].elem).clone(!0),$.glue.contextmenu.register(e,i,l,o),l;return!1},show:function(e){if(p){if(e==p)return;$.glue.contextmenu.hide()}if($(e).hasClass("locked"))for(r=g,i=0;i<h.object.length;i++)"object-lock"==h.object[i].name&&r.push(h.object[i]);else for(var t in h)if($(e).hasClass(t)){r="object"==t?g:m;for(var i=0;i<h[t].length;i++){for(var o=!1,s=0;s<r.length;s++)if(h[t][i].prio<r[s].prio){r.splice(s,0,h[t][i]),o=!0;break}o||r.push(h[t][i])}}var l=$(e).attr("class").replace(/\s+/," ").split(" ");for(t in v)for(i=0;i<l.length;i++)if(t==l[i])for(s=0;s<v[t].length;s++){for(var n=0;n<g.length;n++)g[n].name==v[t][s]&&(g.splice(n,1),n--);for(n=0;n<m.length;n++)m[n].name==v[t][s]&&(m.splice(n,1),n--)}for(i=0;i<2;i++){var r,a=$(e).offset().left,c=$(e).offset().top;0==i?(r=m,g.length?a-$(g[0].elem).outerWidth(!0)<0&&(a=$(g[0].elem).outerWidth(!0)+48):a-48<0&&(a=48)):(r=g,m.length?c-$(m[0].elem).outerHeight(!0)<0&&(c=$(m[0].elem).outerHeight(!0)):c-48<0&&(c=48));for(var u,d,s=0;s<r.length;s++)$(r[s].elem).attr("id","glue-contextmenu-"+r[s].name),r==g?$(r[s].elem).addClass("glue-contextmenu-left"):$(r[s].elem).addClass("glue-contextmenu-top"),$(r[s].elem).addClass("glue-ui"),$(r[s].elem).css("position","absolute"),$(r[s].elem).css("visibility","hidden"),$(r[s].elem).css("z-index","201"),$("body").append(r[s].elem),r==m?($(r[s].elem).css("left",a+"px"),(u=c-$(r[s].elem).outerHeight(!0))<0&&(u=0),$(r[s].elem).css("top",u+"px"),u=$(r[s].elem).outerWidth(!0)):((d=a-$(r[s].elem).outerWidth(!0))<0&&(d=0),$(r[s].elem).css("left",d+"px"),$(r[s].elem).css("top",c+"px"),d=$(r[s].elem).outerHeight(!0)),$(r[s].elem).data("owner",e),$(r[s].elem).trigger("glue-menu-activate"),"none"!=$(r[s].elem).css("display")&&(r==g?c+=d:a+=u,$(r[s].elem).css("visibility",""),$(r[s].elem).hide(),$(r[s].elem).fadeIn(333))}return p=e,!(f=!1)},veto:function(e,t){v[e]||(v[e]=[]),v[e].push(t)}}}(),$.glue.container=function(){return{mode:function(e){if(void 0===e)return 0;container_mode=e},update:function(e){},width:function(e){if(void 0===e)return container_width;container_width=e}}},$.glue.grid=function(){function n(){for(;u.length;){var e=u.shift();$(e).remove()}for(;r.length;){var t=r.shift();$(t).remove()}h=d=!1}var r=[],a=[],c=[],u=[],d=!1,g=0,h=!1,p=50,f=50;return{add_guide_x:function(e){a.push(e)},add_guide_y:function(e){c.push(e)},mode:function(e){if(void 0===e)return g;g=e},update:function(e){if(void 0!==e&&e&&(h=d=!1),1&g){if(d!==$(document).height()||h!==$(document).width()){n(),d=$(document).height(),h=$(document).width();var t="#ffffff";$("body").css("background-color").length&&($.color.setColor($("body").css("background-color")),0!=$.color.getArray()[3])&&(t=$.color.getHex());for(var i=p;i<=h;i+=p){var o=$("<div></div>");$(o).addClass("glue-grid-y"),$(o).addClass("glue-grid"),$(o).addClass("glue-ui"),$(o).css("background-color",$.xcolor.complementary(t)),$(o).css("height",d+"px"),$(o).css("left",i+"px"),$(o).css("position","absolute"),$(o).css("top","0px"),$(o).css("width","1px"),$(o).css("z-index","200"),$("body").append(o),u.push(o)}for(var s,l=f;l<=d;l+=f){o=$("<div></div>");$(o).addClass("glue-grid-x"),$(o).addClass("glue-grid"),$(o).addClass("glue-ui"),$(o).css("background-color",$.xcolor.complementary(t)),$(o).css("height","1px"),$(o).css("left","0px"),$(o).css("position","absolute"),$(o).css("top",l+"px"),$(o).css("width",h+"px"),$(o).css("z-index","200"),$("body").append(o),u.push(o)}for(s in a){o=$("<div></div>");$(o).addClass("glue-guide-x"),$(o).addClass("glue-guide"),$(o).addClass("glue-ui"),$(o).css("background-color",$.xcolor.average($.xcolor.complementary(t),t)),$(o).css("height",d+"px"),$(o).css("left",a[s]+"px"),$(o).css("position","absolute"),$(o).css("top","0px"),$(o).css("width","1px"),$(o).css("z-index","200"),$("body").append(o),r.push(o)}for(s in c){o=$("<div></div>");$(o).addClass("glue-guide-y"),$(o).addClass("glue-guide"),$(o).addClass("glue-ui"),$(o).css("background-color",$.xcolor.average($.xcolor.complementary(t),t)),$(o).css("height","1px"),$(o).css("left","0px"),$(o).css("position","absolute"),$(o).css("top",c[s]+"px"),$(o).css("width",h+"px"),$(o).css("z-index","200"),$("body").append(o),r.push(o)}}}else n();2&g?$(".object").draggable("option","grid",[p,f]):$(".object").draggable("option","grid",!1),4&g?$(".resizable").resizable("option","grid",[p,f]):$(".resizable").resizable("option","grid",!1)},x:function(e){if(void 0===e)return p;p=e},y:function(e){if(void 0===e)return f;f=e}}}(),$.glue.menu=function(){function d(e){$(e.target).hasClass("glue-ui")||0!=$(e.target).parents(".glue-ui").length||$.glue.menu.hide(!1)}var g=!1,h={},p="",f=!1;return $(".object").live("glue-select",function(e){g&&$.glue.menu.hide()}),{hide:function(e){if(void 0!==e&&!e||(p=""),g){for(var t=0;t<g.length;t++)$(g[t].elem).trigger("glue-menu-deactivate"),$(g[t].elem).detach();g=!1}$("body").unbind("click",d)},is_shown:function(e){return void 0===e?!!g:!(!h[e]||h[e]!=g)},prev_menu:function(){var e=p;return p="",e},register:function(e,t,i){h[e]||(h[e]=[]),void 0===i&&(i=10);for(var o=!1,s=0;s<h[e].length;s++)if(i<h[e][s].prio){h[e].splice(s,0,{elem:t,prio:i}),o=!0;break}o||h[e].push({elem:t,prio:i})},show:function(e,t,i){if(!h[e])return!1;g&&$.glue.menu.hide(),void 0===t&&(t=$(window).width()/2),void 0===i&&(i=$(window).height()/2);var o=0,s=0;g=h[e];for(var l=num_shown=0;l<g.length;l++){var n=g[l].elem;$(n).addClass("glue-menu-"+e),$(n).addClass("glue-menu"),$(n).addClass("glue-ui"),$(n).css("left",t+"px"),$(n).css("position","fixed"),$(n).css("top",i+"px"),$(n).css("visibility","hidden"),$(n).css("z-index","201"),$("body").append(n),$(n).trigger("glue-menu-activate"),"none"!=$(n).css("display")&&(num_shown++,o<$(n).outerWidth(!0)&&(o=$(n).outerWidth(!0)),s<$(n).outerHeight(!0))&&(s=$(n).outerHeight(!0))}for(var r=1;r*r<num_shown;)r++;for(var a=r,c=(num_shown<=r*(r-1)&&a--,0),u=0,l=0;l<g.length;l++){n=g[l].elem;"none"!=$(n).css("display")&&(u==a&&(c++,u=0),$(n).css("opacity","0.0"),$(n).css("visibility",""),$(n).animate({left:t-r*o/2+u*o+"px",opacity:1,top:i-r*s/2+c*s+"px"},200),u++)}return $("body").bind("click",d),p=e,f={x:$(document).scrollLeft()+t,y:$(document).scrollTop()+i},!0},spawn_coords:function(){return f}}}(),$.glue.object=function(){var l={},t=!1,i={};return $(".resizable").live("glue-pre-clone",function(e){$(this).removeClass("ui-resizable"),$(this).children(".ui-resizable-handle").remove()}),$(".object").live("resize",function(e){e.ctrlKey?!1!==$(this).resizable("option","grid")&&(t=$(this).resizable("option","grid"),$(this).resizable("option","grid",!1)):t&&($(this).resizable("option","grid",t),t=!1),$.glue.object.resizable_update_tooltip(this),$(this).trigger("glue-resize")}),$(".object").live("resizestart",function(e){$(this).trigger("glue-resizestart")}),$(".object").live("resizestop",function(e){t&&($(this).resizable("option","grid",t),t=!1),$.glue.object.save(this),$(this).trigger("glue-resizestop"),$.glue.canvas.update(this)}),$(document).ready(function(){$.glue.object.register_alter_pre_save("resizable",function(e,t){$(e).removeClass("ui-resizable"),$(e).children(".ui-resizable-handle").remove()}),$.glue.object.register_alter_pre_save("object",function(e,t){$(e).removeClass("ui-draggable-dragging")}),$.glue.object.register_alter_pre_save("glue-selected",function(e,t){var i=$(t).outerHeight()-$(t).innerHeight(),t=$(t).position();$(e).removeClass("glue-selected"),$(e).css("left",t.left+i/2+"px"),$(e).css("top",t.top+i/2+"px")})}),{register:function(e){if(i[$(e).attr("id")])return!1;i[$(e).attr("id")]=!0,isNaN(parseInt($(e).css("z-index")))&&$(e).css("z-index",$.glue.stack.default_z()),$(e).draggable({addClasses:!1,distance:10}),$(e).hasClass("resizable")&&($(e).resizable(),$.glue.object.resizable_update_tooltip(e)),$(e).trigger("glue-register"),$.glue.canvas.update(e)},register_alter_pre_save:function(e,t){l[e]=t},resizable_update_tooltip:function(e){var t=$(e).position();$(e).children(".ui-resizable-handle").attr("title",$(e).innerWidth()+"x"+$(e).innerHeight()+" at "+t.left+"x"+t.top)},save:function(e){for(var t=$(e).clone(),i=$(t).attr("class").replace(/\s+/," ").split(" "),o=0;o<i.length;o++)"function"==typeof l[i[o]]&&l[i[o]](t,e);$(t).html($.trim($(t).html()));var s=$("<div></div>").html(t).html();$.glue.backend({method:"glue.save_state",html:s})},unregister:function(e){$(e).trigger("glue-unregister")}}}(),$.glue.sel=function(){var i=!1,o=!1,s=!1,l=!1,n=!1,r=!1,r=!1,g=!1;return $("html").bind("click",function(e){e.target==$("body").get(0)&&$(".glue-selected").length&&($.glue.sel.none(),e.stopImmediatePropagation())}),$("html").bind("keydown",function(e){var t,i,o,s,l,n,r,a,c,u,d;return 9==e.which?($(".glue-selected").length<2&&(d=!1,d=$(".glue-selected").next(".object").length?$(".glue-selected").next(".object"):$(".object").first())&&($.glue.sel.none(),$.glue.sel.select(d),s=(o=$(document).scrollLeft())+$(window).width(),n=(l=$(document).scrollTop())+$(window).height(),u=$(d).outerHeight(),a=$(d).position(),c=$(d).outerWidth(),a.left<o?$(document).scrollLeft(a.left):s<a.left+c&&$(document).scrollLeft(o+a.left+c-s),a.top<l?$(document).scrollTop(a.top):n<a.top+u&&$(document).scrollTop(l+a.top+u-n)),!1):!(33==e.which&&e.shiftKey&&$(".glue-selected").length||34==e.which&&e.shiftKey&&$(".glue-selected").length)&&(37<=e.which&&e.which<=40&&$(".glue-selected").length?(i=t=0,38==e.which?i=-1:39==e.which?t=1:40==e.which?i=1:37==e.which&&(t=-1),e.shiftKey&&(t*=$.glue.grid.x(),i*=$.glue.grid.y()),$(".glue-selected").not(".locked").each(function(){var e=$(this).position();1<e.left+t+$(this).outerWidth()&&$(this).css("left",e.left+t+"px"),1<e.top+i+$(this).outerHeight()&&$(this).css("top",e.top+i+"px")}),1==$(".glue-selected").length&&(s=(o=$(document).scrollLeft())+$(window).width(),n=(l=$(document).scrollTop())+$(window).height(),r=$(".glue-selected"),a=$(r).position(),c=$(r).outerWidth(),u=$(r).outerHeight(),a.left<o?$(document).scrollLeft(a.left):s<a.left+c&&$(document).scrollLeft(a.left+c),a.top<l?$(document).scrollTop(a.top):n<a.top+u&&$(document).scrollTop(a.top+u)),g||($(".glue-selected").not(".locked").trigger("glue-movestart"),g=!0),!1):e.ctrlKey&&65==e.which?($(".object").not(".glue-selected").not(".locked").each(function(){$.glue.sel.select($(this))}),$(".locked.glue-selected").each(function(){$.glue.sel.deselect($(this))}),!1):e.ctrlKey&&68==e.which?($.glue.sel.none(),!1):e.ctrlKey&&73==e.which?(d=$(".object").not(".glue-selected").not(".locked"),$.glue.sel.none(),$(d).each(function(){$.glue.sel.select($(this))}),!1):void 0)}),$("html").bind("keyup",function(e){return 33==e.which&&e.shiftKey&&$(".glue-selected").length?($(".glue-selected").not(".locked").each(function(){$.glue.stack.to_top($(this)),$.glue.object.save($(this))}),$.glue.stack.compress(),!1):34==e.which&&e.shiftKey&&$(".glue-selected").length?($(".glue-selected").not(".locked").each(function(){$.glue.stack.to_bottom($(this)),$.glue.object.save($(this))}),$.glue.stack.compress(),!1):37<=e.which&&e.which<=40&&$(".glue-selected").length?($(".glue-selected").not(".locked").trigger("glue-movestop"),g=!1):46==e.which&&$(".glue-selected").length?(e=$(".glue-selected").not(".locked"),$(e).each(function(){var e=$(this).attr("id");$.glue.object.unregister($(this)),$(this).remove(),$.glue.backend({method:"glue.delete_object",name:e}),$.glue.canvas.update()}),!1):void 0}),$(".object").live("dragstart",function(e){l=$(this).position().left,n=$(this).position().top,r=e.pageX,drag_mouse_start_y=e.pageY,$(this).draggable("option","axis",!1),$(this).hasClass("glue-selected")||$(this).trigger("glue-movestart")}),$(".object").live("dragstop",function(e){i&&($(this).draggable("option","grid",i),i=!1)}),$(".object").live("drag",function(e){var t;e.ctrlKey?!1!==$(this).draggable("option","grid")&&(i=$(this).draggable("option","grid"),$(this).draggable("option","grid",!1)):i&&($(this).draggable("option","grid",i),i=!1),e.shiftKey?(t=Math.abs(e.pageX-r)<Math.abs(e.pageY-drag_mouse_start_y)?"y":"x",e=Math.abs(Math.abs(e.pageX-r)-Math.abs(e.pageY-drag_mouse_start_y)),(0==$(this).draggable("option","axis")||50<e&&$(this).draggable("option","axis")!=t)&&($(this).css("left",l+"px"),$(this).css("top",n+"px"),$(this).draggable("option","axis",t))):$(this).draggable("option","axis",!1)}),$(".object").live("dragstop",function(e){$(this).hasClass("glue-selected")||$(this).trigger("glue-movestop")}),$(".glue-selected").live("drag",function(e){var t,i;1<$(".glue-selected").length&&(t=this,i=$(this).position(),$(".glue-selected").each(function(){var e;this!=t&&(e=$(this).position(),$(this).css("left",e.left+i.left-o+"px"),$(this).css("top",e.top+i.top-s+"px"))}),o=i.left,s=i.top)}),$(".glue-selected").live("dragstart",function(e){var t;1<$(".glue-selected").length&&(t=$(this).position(),o=t.left,s=t.top),$(".glue-selected").trigger("glue-movestart")}),$(".glue-selected").live("dragstop",function(e){var t=this,i=$(this).position();$(".glue-selected").each(function(){var e;this!=t&&(e=$(this).position(),$(this).css("left",e.left+i.left-o+"px"),$(this).css("top",e.top+i.top-s+"px"))}),$(".glue-selected").trigger("glue-movestop")}),$(".object").live("click",function(e){e.shiftKey||$(this).hasClass("glue-selected")||$.glue.sel.none(),e.shiftKey&&$(this).hasClass("glue-selected")?$.glue.sel.deselect($(this)):e.shiftKey&&$(this).hasClass("locked")||$(".glue-selected").hasClass("locked")||$.glue.sel.select($(this))}),$(".object").live("glue-movestop",function(e){$.glue.object.resizable_update_tooltip(this),$.glue.object.save(this),$.glue.canvas.update(this)}),$(".object").live("glue-unregister",function(e){$.glue.sel.deselect($(this))}),{deselect:function(e){var t,i;$(e).hasClass("glue-selected")&&(t=$(e).outerHeight()-$(e).innerHeight(),$(e).removeClass("glue-selected"),$(e).trigger("glue-deselect"),i=$(e).position(),$(e).css("left",i.left+t/2+"px"),$(e).css("top",i.top+t/2+"px"))},none:function(){$(".glue-selected").each(function(){$.glue.sel.deselect($(this))})},select:function(e){var t,i;$(e).hasClass("glue-selected")||($(e).addClass("glue-selected"),$(e).trigger("glue-select"),t=$(e).position(),i=$(e).outerHeight()-$(e).innerHeight(),$(e).css("left",t.left-i/2+"px"),$(e).css("top",t.top-i/2+"px"))},selected:function(e){return $(e).hasClass("glue-selected")}}}(),$.glue.slider=function(e,t,i){function o(e){return"function"==typeof t&&t(e.pageX-l.pageX,e.pageY-l.pageY,e),!1}function s(e){return $("html").unbind("mousemove",o),$("html").unbind("mouseup",s),"function"==typeof t&&t(e.pageX-l.pageX,e.pageY-l.pageY,e),"function"==typeof i&&i(e.pageX-l.pageX,e.pageY-l.pageY,e),!1}var l=e;$("html").bind("mousemove",o),$("html").bind("mouseup",s)},$.glue.stack=function(){function o(e,t){var i=$(e).outerHeight(),o=$(e).position(),e=$(e).outerWidth(),s=$(t).outerHeight(),l=$(t).position(),t=$(t).outerWidth();return o.left<=l.left+t&&l.left<=o.left+e&&o.top<=l.top+s&&l.top<=o.top+i}return{compress:function(){var t=-1,i=200,o=0;$(".object").not(".locked").each(function(){var e=parseInt($(this).css("z-index"));isNaN(e)||(e<i&&(i=e),t<e&&(t=e))});for(var s=i;s<=t;s++){var l=!1;$(".object").not(".locked").each(function(){var e=parseInt($(this).css("z-index"));isNaN(e)||e==s&&(l=!0)}),l||(t--,$(".object").not(".locked").each(function(){var e=parseInt($(this).css("z-index"));isNaN(e)||s<e&&($(this).css("z-index",--e),$(this).addClass("need_save"))}))}o=100-Math.round((t-i)/2)-i,Math.abs(o)<20?o=0:$(".object").addClass("need_save"),$(".need_save").each(function(){var e=parseInt($(this).css("z-index"));isNaN(e)||($(this).css("z-index",e+o),$.glue.object.save(this)),$(this).removeClass("need_save")})},default_z:function(){return 100},to_bottom:function(t){var i=200,e=parseInt($(t).css("z-index"));return $(".object").not(".locked").each(function(){var e;this!=$(t).get(0)&&o(t,this)&&$(this).css("z-index").length&&(e=parseInt($(this).css("z-index")),!isNaN(e))&&e<i&&(i=e)}),!!((isNaN(e)||i<=e)&&i<=199&&0<i)&&($(t).css("z-index",i-1),!0)},to_top:function(t){var i=-1,e=parseInt($(t).css("z-index"));return $(".object").not(".locked").each(function(){var e;this!=$(t).get(0)&&o(t,this)&&$(this).css("z-index").length&&(e=parseInt($(this).css("z-index")),!isNaN(e))&&i<e&&(i=e)}),!!((isNaN(e)||e<=i)&&0<=i&&i<199)&&($(t).css("z-index",i+1),!0)}}}(),$.glue.upload=function(){function o(e,t){void 0===e&&(e=0),void 0===t&&(t=0);var i=0;return{error:function(e){0==--i&&$(this.status).detach(),e&&e.target&&e.target.status?$.glue.error("There was a problem uploading a file (status "+e.target.status+")"):($.glue.error("There was a problem uploading a file. Make sure you are not exceeding the file size limits set in the server configuration."),console.error(e))},finish:function(e){0==--i&&$(this.status).detach(),$.glue.upload.handle_response(e,this.x,this.y)},progress:function(e){$(this.status).children(".glue-upload-statusbar-done").css("width",e.loaded/e.total*100+"%"),$(this.status).attr("title",e.loaded+" of "+e.total+" bytes ("+(e.loaded/e.total*100).toFixed(1)+"%)")},start:function(e){$.glue.menu.hide(),i++,$("body").append(this.status),$(this.status).children(".glue-upload-statusbar-done").css("width","0%"),$(this.status).css("left",this.x-$(this.status).outerWidth()/2+"px"),$(this.status).css("top",this.y-$(this.status).outerHeight()/2+"px")},status:$('<div class="glue-upload-statusbar glue-ui" style="position: absolute; z-index: 202;"><div class="glue-upload-statusbar-done"></div></div>'),x:e,y:t}}return $(document).ready(function(){var e=$('<div style="height: 32px; max-height: 32px; max-width: 32px; overflow: hidden; width: 32px;"><img src="'+$.glue.base_url+'img/upload.png" alt="btn" width="32" height="32"></div>'),i=o();i.multiple=!0,$.glue.upload.button(e,{method:"glue.upload_files",page:$.glue.page},i),$(e).bind("click",function(e){var t=$.glue.menu.spawn_coords();i.x=t.x,i.y=t.y}),$.glue.menu.register("new",e,11),$("html").get(0).addEventListener("dragover",function(e){e.stopPropagation(),e.preventDefault()},!1),$("html").get(0).addEventListener("drop",function(e){e.stopPropagation(),e.preventDefault();var t=o(e.pageX,e.pageY);$.glue.upload.files(e.dataTransfer.files,{method:"glue.upload_files",page:$.glue.page},t)},!1)}),{button:function(e,t,i){(i=i||{}).tooltip||(i.tooltip="upload a file"),$(e).prepend('<input type="file" title="'+i.tooltip+'" style="height: 100%; opacity: 0; position: absolute; width: 100%; z-index: 300;">'),i.multiple&&$(e).children("input").first().attr("multiple","multiple"),$(e).children("input").first().bind("change",function(e){return this.files&&0!=this.files.length?$.glue.upload.files(this.files,t,i):"function"==typeof i.abort&&i.abort(),!1})},files:function(e,t,i){t=t||{},i=i||{};var o=new XMLHttpRequest;if("function"==typeof i.progress&&(o.upload.onprogress=function(e){i.progress(e)}),"function"==typeof i.finish&&(o.onload=function(e){try{i.finish($.parseJSON(e.target.responseText))}catch(e){"function"==typeof i.error&&i.error(e)}}),"function"==typeof i.error&&(o.onerror=function(e){i.error(e)}),o.open("POST",$.glue.base_url+"json.php",!0),window.FormData){var s=new FormData;for(n in t)s.append(n,JSON.stringify(t[n]));for(var l=0;l<e.length;l++)s.append("user_file"+l,e[l]);return o.send(s),"function"==typeof i.start&&i.start(e),!0}if(e[0]&&e[0].getAsBinary){var n,r="----multipartformboundary"+(new Date).getTime(),a="";for(n in t)a=(a=(a+="--"+r+"\r\n")+'Content-Disposition: form-data; name="'+n+'"\r\n\r\n')+JSON.stringify(t[n])+"\r\n";for(l=0;l<e.length;l++){var c=e[l],a=a+("--"+r+"\r\n")+('Content-Disposition: form-data; name="user_file'+l+'"');c.fileName&&(a+='; filename="'+c.fileName+'"'),a+="\r\n",c.type?a+="Content-Type: "+c.type+"\r\n":a+="Content-Type: application/octet-stream\r\n",a=(a+="\r\n")+c.getAsBinary()+"\r\n"}return a+="--"+r+"--\r\n",o.setRequestHeader("Content-Type","multipart/form-data; boundary="+r),o.sendAsBinary(a),"function"==typeof i.start&&i.start(e),!0}return $.glue.error("Your browser is not supported. Update to a recent version of Firefox or Chrome."),"function"==typeof i.abort&&i.abort(),!1},handle_response:function(e,t,i){if(e)if(e["#error"])$.glue.error("There was a problem uploading the file ("+e["#data"]+")");else if(0==e["#data"].length)$.glue.error("The server did not reply with any object. The file type you were uploading could either not be supported (look around for more modules!) or there could be an internal problem. Check the log file to be sure!");else{$.glue.sel.none();for(var o=0;o<e["#data"].length;o++){var s,l,n,r=$(e["#data"][o]),a=function(e){var t,i=e.data.mode,o=e.data.target_x,e=e.data.target_y;t=$(this).hasClass("object")?$(this):$(this).parents(".object").first(),$(t).css("width",$(t).width()+"px"),$(t).css("height",$(t).height()+"px"),$(t).trigger("glue-upload-dynamic-late",[this]),"center"==i?($(t).css("left",o-$(t).outerWidth()/2+"px"),$(t).css("top",e-$(t).outerHeight()/2+"px")):($(t).css("left",o+"px"),$(t).css("top",e+"px")),$(t).css("visibility",$(t).data("orig_visibility")),$(t).removeData("orig_visibility"),$.glue.object.register(t),$.glue.object.save(t)},c=(n=1==e["#data"].length?(s="center",l=t,i):(s="stack",l=t+o*$.glue.grid.x(),i+o*$.glue.grid.y()),parseInt($(r).get(0).style.getPropertyValue("width")));isNaN(c)||0===c?($(r).bind("load",{mode:s,target_x:l,target_y:n},a),$(r).find("*").bind("load",{mode:s,target_x:l,target_y:n},a),$(r).data("orig_visibility",$(r).css("visibility")),$(r).css("visibility","hidden"),$("body").append(r),$(r).trigger("glue-upload-dynamic-early",[s,l,n])):($("body").append(r),"center"==s?($(r).css("left",l-$(r).outerWidth()/2+"px"),$(r).css("top",n-$(r).outerHeight()/2+"px")):($(r).css("left",l+"px"),$(r).css("top",n+"px")),$.glue.object.register(r),$(r).trigger("glue-upload-static",[s]),$.glue.object.save(r))}}else $.glue.error("There was a problem communicating with the server")}}}(),$(document).ready(function(){$(".object").each(function(){$.glue.object.register($(this))}),$.glue.canvas.update(),$(window).bind("resize",function(e){clearTimeout(t),t=setTimeout(function(){$.glue.canvas.update()},100)});var t,i=!1;$("html").bind("click",function(e){if(window.focus(),e.target==$("body").get(0)&&!$.glue.menu.is_shown()){if(i)return clearTimeout(i),i=!1,$.glue.menu.show("page",e.clientX,e.clientY),!1;i=setTimeout(function(){i=!1,""==$.glue.menu.prev_menu()&&$.glue.menu.show("new",e.clientX,e.clientY)},300)}}),$("html").bind("keyup",function(e){return e.altKey&&79==e.which?($.glue.menu.show("new"),!1):e.altKey&&80==e.which?($.glue.menu.show("page"),!1):e.ctrlKey&&90==e.which&&confirm('Looking for an "undo" option?\nHOTGLUE keeps record of your recent edits - it\'s called "revisions".\nWould you like to browse through the revisions of this page?')?(window.location=$.glue.base_url+"?"+$.glue.page+"/revisions",!1):void 0}),$("html").bind("mousedown",function(e){return!1})});